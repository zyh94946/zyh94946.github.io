<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="theme-color" content="#000000"><meta name="msapplication-TileColor" content="#000000"><script>window.ga_tid="UA-146915508-1",window.ga_url="https://ga.ibelieving.io"</script><script async src="/js/ga.min.js"></script><title>通过 Netmaker 配置 WireGuard 跨 VPC 组网 | ibelieving.io - 技术分享 - 行者无疆</title><meta name="keywords" content="微服务, 服务网格, 架构设计, PHP, Golang, Linux"><link rel="apple-touch-icon" sizes="180x180" href="/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="192x192" href="/favicons/android-chrome-192x192.png"><link rel="icon" type="image/png" sizes="32x32" href="/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/favicons/favicon-16x16.png"><link rel="mask-icon" href="/favicons/safari-pinned-tab.svg" color="#000000"><meta name="msapplication-config" content="/favicons/browserconfig.xml"><link rel="alternate" href="/atom.xml" title="ibelieving.io - 技术分享" type="application/atom+xml"><link rel="shortcut icon" type="image/x-icon" href="/favicons/favicon.ico"><link rel="stylesheet" href="/css/normalize.css"><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="/css/sidebar.css"><link rel="stylesheet" href="/css/page.css"><link rel="stylesheet" href="/css/post.css"><link rel="stylesheet" href="/css/custom.css"><link rel="stylesheet" href="/css/atom-one-dark.css"><link rel="stylesheet" href="/css/lightgallery.min.css"><script src="/js/jquery.min.js"></script><script defer src="/js/util.js"></script><script defer src="/js/clipboard.min.js"></script><script defer src="/js/scrollspy.js"></script><script defer src="/js/fontawesome-all.min.js"></script><script defer src="/js/lightgallery.min.js"></script><script defer src="/js/lg-fullscreen.min.js"></script><script defer src="/js/lg-hash.min.js"></script><script defer src="/js/lg-pager.min.js"></script><script defer src="/js/lg-thumbnail.min.js"></script><script defer src="/js/lg-zoom.min.js"></script><script defer src="/js/busuanzi.pure.mini.js"></script><script defer src="/js/search.js"></script><script>$(document).ready(function(){var e="search.xml";0===e.length&&(e="search.xml"),searchFunc("/"+e,"search-input","search-result")})</script><script defer src="/js/index.js"></script><script>$(document).ready(function(){var t=$(".post figure.highlight");(t.length?($(t).each(function(t,n){$(n).before('<button class="copy button">复制</button>')}),new ClipboardJS("button.copy",{target:function(t){return t.nextElementSibling.firstChild.firstChild.firstChild.lastChild.firstChild.firstChild}})):(t=$(".post pre code"),$(t).each(function(t,n){$(n).parent().before('<button class="copy button">复制</button>')}),new ClipboardJS("button.copy",{target:function(t){return t.nextElementSibling.firstChild}}))).on("success",function(t){t.clearSelection();var n=t.trigger;n.innerHTML="已复制",$(n).addClass("copied"),setTimeout(function(){n.innerHTML="复制",$(n).removeClass("copied")},1500)})})</script><script defer src="/js/custom.js"></script><meta name="generator" content="Hexo 4.2.1"></head><body itemscope itemtype="https://schema.org/WebPage" lang="zh-CN" data-spy="scroll" data-target=".list-group"><header id="header" class="header" style="background-color:#000"><div class="container"><div class="header-container"><div class="header-title"><h1 class="title"><a href="/">ibelieving.io - 技术分享</a></h1><h2 class="subtitle">行者无疆</h2></div></div><nav id="nav" class="nav"><a id="nav-toggle" class="nav-toggle" aria-hidden="true"><i class="fas fa-bars" aria-label="切换导航栏"></i></a><ul id="menu" role="menubar" aria-hidden="false"><li role="menuitem"><a href="/"><i class="fas fa-home"></i><span class="menu-text">首页</span></a></li><li role="menuitem"><a href="/archives/"><i class="fas fa-archive"></i><span class="menu-text">归档</span></a></li></ul></nav></div></header><main id="main" class="main"><div class="container"><div class="main-container"><div class="content"><div id="post" class="page"><article class="article post card" itemscope itemtype="https://schema.org/Article"><div class="post-block"><link itemprop="mainEntityOfPage" href="https://ibelieving.io/2022/03/13/netmaker/"><span hidden itemprop="author" itemscope itemtype="https://schema.org/Person"><meta itemprop="name" content="Zhongyang Hao"><meta itemprop="description" content="技术分享，包括不限于微服务、服务网格。主要开发语言PHP、Golang。"><meta itemprop="image" content="/images/avatar.gif"></span><span hidden itemprop="publisher" itemscope itemtype="https://schema.org/Organization"><meta itemprop="name" content="ibelieving.io - 技术分享"></span></div><header class="post-header"><h1 class="post-title" itemprop="name headline">通过 Netmaker 配置 WireGuard 跨 VPC 组网</h1><div class="post-meta"><span class="post-date"><i class="far fa-calendar-plus"></i><span><time title="post-date" itemprop="dateCreated datePublished" datetime="2022-03-13T20:15:00+08:00">2022-03-13 晚上</time></span></span></div></header><main class="post-main" itemprop="articleBody"><h1 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h1><p>最近云服务商做活动，手里云主机又多了一个，国内的有三台了，可以组个 k8s 集群了。本文介绍如何跨 VPC 组网，机器情况如下。</p><table><thead><tr><th>hostname</th><th>外网ip</th><th>内网ip</th><th>os</th></tr></thead><tbody><tr><td>ten-1</td><td>62.234.xxx.xxx</td><td>172.21.0.xxx</td><td>CentOS 7.6</td></tr><tr><td>ten-2</td><td>82.156.xxx.xxx</td><td>10.0.8.xxx</td><td>CentOS 7.9</td></tr><tr><td>ten-3</td><td>81.70.xxx.xxx</td><td>10.0.24.xxx</td><td>CentOS 7.6</td></tr><tr><td>MacBook</td><td>-</td><td>-</td><td>Darwin 10.15.6</td></tr></tbody></table><ul><li><code>WireGuard</code> 是由 <code>C</code> 语言写的开源 <code>VPN</code> 方案。概括来讲更快、更简单、更安全，<code>Linux</code> 内核 <code>5.6</code> 版本开始自带。且支持全平台。</li><li><code>Netmaker</code> 是一个可视化操作工具，方便我们对 <code>WrireGuard</code> 的配置管理，相比于直接写配置，当节点多起来会便捷不少。</li></ul><p>简单说下运行流程，<code>Netmaker</code> 分服务端和客户端，客户端是 <code>netclient</code>。我们在 <code>Netmaker</code> 上创建虚拟网络，然后在想要加入网络的节点上通过 <code>netclient</code> 加入。<code>Netmaker</code> 会对加入网络的节点自动同步 <code>WireGuard</code> 的配置信息，创建相应的路由规则，之后节点与节点之间的通信直接进行。<br>本文只是介绍了一部分 <code>Netmaker</code> 功能，更多内容请看 <a href="https://docs.netmaker.org/index.html" target="_blank" rel="noopener">Netmaker 官方文档</a>。</p><p>为了方便 <code>CentOS</code> 内核都已升级至 <code>5.16</code>，自带了 <code>WireGuard</code>。升级内核教程很多就不多说了。</p><h1 id="Netmaker-部署"><a href="#Netmaker-部署" class="headerlink" title="Netmaker 部署"></a>Netmaker 部署</h1><p>在 <code>ten-1</code> 上先创建所需目录</p><figure class="hljs highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ mkdir -p /etc/netclient/config<br>$ mkdir -p /data/netmaker<br></code></pre></td></tr></table></figure><p>直接容器化部署，<code>compose yml</code> 如下：</p><figure class="hljs highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-attr">version:</span> <span class="hljs-string">"3.4"</span><br><br><span class="hljs-attr">services:</span><br><span class="hljs-attr">  netmaker:</span><br><span class="hljs-attr">    container_name:</span> <span class="hljs-string">netmaker</span><br><span class="hljs-attr">    image:</span> <span class="hljs-string">gravitl/netmaker:v0.9.4</span><br><span class="hljs-attr">    volumes:</span><br><span class="hljs-bullet">      -</span> <span class="hljs-string">/etc/netclient/config:/etc/netclient/config</span><br><span class="hljs-attr">      - dnsconfig:</span><span class="hljs-string">/root/config/dnsconfig</span><br><span class="hljs-bullet">      -</span> <span class="hljs-string">/usr/bin/wg:/usr/bin/wg</span><br><span class="hljs-bullet">      -</span> <span class="hljs-string">/data/netmaker:/root/data</span><br><span class="hljs-attr">    cap_add:</span><br><span class="hljs-bullet">      -</span> <span class="hljs-string">NET_ADMIN</span><br><span class="hljs-attr">    restart:</span> <span class="hljs-string">always</span><br><span class="hljs-attr">    network_mode:</span> <span class="hljs-string">host</span><br><span class="hljs-attr">    environment:</span><br><span class="hljs-attr">      SERVER_HOST:</span> <span class="hljs-string">"SERVER_PUBLIC_IP"</span><br><span class="hljs-attr">      COREDNS_ADDR:</span> <span class="hljs-string">"SERVER_PUBLIC_IP"</span><br><span class="hljs-attr">      GRPC_SSL:</span> <span class="hljs-string">"off"</span><br><span class="hljs-attr">      DNS_MODE:</span> <span class="hljs-string">"on"</span> <span class="hljs-comment"># dns 不需要直接 off 把下面 coredns 部分也注释</span><br><span class="hljs-attr">      CLIENT_MODE:</span> <span class="hljs-string">"on"</span> <span class="hljs-comment"># 开启 CLIENT_MODE 则默认将 netmaker server 也当做网络节点</span><br><span class="hljs-attr">      API_PORT:</span> <span class="hljs-string">"8081"</span> <span class="hljs-comment"># 记得在服务器安全策略或防火墙上对该端口放行</span><br><span class="hljs-attr">      GRPC_PORT:</span> <span class="hljs-string">"50051"</span> <span class="hljs-comment"># 记得在服务器安全策略或防火墙上对该端口放行</span><br><span class="hljs-attr">      SERVER_GRPC_WIREGUARD:</span> <span class="hljs-string">"off"</span><br><span class="hljs-attr">      CORS_ALLOWED_ORIGIN:</span> <span class="hljs-string">"*"</span><br><span class="hljs-attr">      DATABASE:</span> <span class="hljs-string">"sqlite"</span><br><span class="hljs-attr">  netmaker-ui:</span><br><span class="hljs-attr">    container_name:</span> <span class="hljs-string">netmaker-ui</span><br><span class="hljs-attr">    depends_on:</span><br><span class="hljs-bullet">      -</span> <span class="hljs-string">netmaker</span><br><span class="hljs-attr">    image:</span> <span class="hljs-string">gravitl/netmaker-ui:v0.9.4</span><br><span class="hljs-attr">    links:</span><br><span class="hljs-bullet">      -</span> <span class="hljs-string">"netmaker:api"</span><br><span class="hljs-attr">    ports:</span><br><span class="hljs-bullet">      -</span> <span class="hljs-string">"127.0.0.1:8082:80"</span> <span class="hljs-comment"># 如果你没有域名直接用公网ip就改成 "80:80"</span><br><span class="hljs-attr">    environment:</span><br><span class="hljs-attr">      BACKEND_URL:</span> <span class="hljs-string">"https://api.NETMAKER_BASE_DOMAIN"</span> <span class="hljs-comment"># 无证书用http，如果你没有域名直接用公网ip就改成 "http://SERVER_PUBLIC_IP:8081"</span><br><span class="hljs-attr">    restart:</span> <span class="hljs-string">always</span><br><span class="hljs-attr">  coredns:</span><br><span class="hljs-attr">    depends_on:</span><br><span class="hljs-bullet">      -</span> <span class="hljs-string">netmaker</span><br><span class="hljs-attr">    image:</span> <span class="hljs-string">coredns/coredns</span><br><span class="hljs-attr">    command:</span> <span class="hljs-bullet">-conf</span> <span class="hljs-string">/root/dnsconfig/Corefile</span><br><span class="hljs-attr">    container_name:</span> <span class="hljs-string">coredns</span><br><span class="hljs-attr">    restart:</span> <span class="hljs-string">always</span><br><span class="hljs-attr">    network_mode:</span> <span class="hljs-string">host</span><br><span class="hljs-attr">    volumes:</span><br><span class="hljs-attr">      - dnsconfig:</span><span class="hljs-string">/root/dnsconfig</span><br><span class="hljs-attr">volumes:</span><br><span class="hljs-attr">  dnsconfig:</span> <span class="hljs-string">&#123;&#125;</span><br></code></pre></td></tr></table></figure><p>更多参数配置请参考</p><ul><li><a href="https://github.com/gravitl/netmaker/tree/v0.9.4/compose" target="_blank" rel="noopener">官方 compose 示例</a></li><li><a href="https://docs.netmaker.org/server-installation.html" target="_blank" rel="noopener">官方说明</a></li></ul><p>如果你是直接用公网ip方式访问 netmaker ui 那直接把注释说明的地方修改下跑起来就可以进入下一节了。</p><p><img src="/images/netmaker_0.jpg" alt="启动"></p><p>如果你使用域名访问，可以参考下我的方案。<br>首先解析域名 <code>api.NETMAKER_BASE_DOMAIN</code>，<code>dashboard.NETMAKER_BASE_DOMAIN</code> 至 <code>ten-1</code>。<br>然后我使用 <code>Traefik</code> 将域名 <code>dashboard.NETMAKER_BASE_DOMAIN</code> 反代 netmaker ui 也就是 <code>127.0.0.1:8082</code>。你可以参考官网选择 Caddy 或 Nginx。<br><code>Traefik</code> 配置就不贴了，之前文章写过很多次。</p><h1 id="Netmaker-创建网络"><a href="#Netmaker-创建网络" class="headerlink" title="Netmaker 创建网络"></a>Netmaker 创建网络</h1><p>打开 <code>Netmaker UI</code>，首次打开会创建一个用户，然后登录。</p><p><img src="/images/netmaker_1.jpg" alt="Dashboard"></p><ul><li>Networks 虚拟网络管理</li><li>Nodes 节点管理，Ingress 和 Egress 网关配置等。</li><li>Access Keys 密钥管理</li><li>External Clients 安卓或苹果端加入网络使用</li><li>DNS</li><li>Users 配置用户管理网络，支持多租户</li></ul><p>然后进入 <code>Networks</code> 创建一个虚拟网络，比如 <code>10.1.0.0/16</code>。</p><p><img src="/images/netmaker_2.jpg" alt="创建网络"></p><ul><li>网络默认监听端口是 51821 记得对该端口放行（运行Netmaker的节点）</li></ul><p>这样虚拟网络就创建成功了。</p><h1 id="加入节点"><a href="#加入节点" class="headerlink" title="加入节点"></a>加入节点</h1><p>加入节点有两种方式，先说第一种：</p><p>在网络里点 <code>Access keys</code> 创建 <code>Key</code>，获得 <code>Token</code>。</p><p><img src="/images/netmaker_3.jpg" alt="Access Keys"><br><img src="/images/netmaker_4.png" alt="Create Key"></p><p><code>uses</code> 代表这个 <code>Key</code> 可以用于几个节点</p><p><img src="/images/netmaker_5.jpg" alt="Success"></p><p>然后去要加入网络的节点上执行 <code>Install Commands</code> 加入网络。执行的逻辑就是下载 <code>netclient</code> 然后通过 <code>Token</code> 加入网络，<code>Token</code> 里面包含了 <code>Netmaker</code> 的服务端配置信息。<br>所以你也可以从 <a href="https://github.com/gravitl/netmaker/releases/tag/v0.9.4" target="_blank" rel="noopener">这里</a> 手动下载 <code>netclient</code> 执行：<code>netclient join -t TOKEN</code> 。</p><p>第二种是进入网络把 <code>Without Keys</code> 打开</p><p><img src="/images/netmaker_6.jpg" alt="Without Keys"></p><p>然后在节点上执行</p><p><code>netclient join --dnson no --network ten --apiserver NETMAKE_DOMAIN_OR_IP:8081 --grpcserver NETMAKE_DOMAIN_OR_IP:50051</code></p><p>在 <code>Nodes</code> 下对刚加入的节点执行同意加入</p><p><img src="/images/netmaker_7.jpg" alt="approve"></p><h2 id="macOS-的加入"><a href="#macOS-的加入" class="headerlink" title="macOS 的加入"></a>macOS 的加入</h2><p>也是先下载 <code>netclient</code>，下载时候注意平台如果是 M1 芯片下载 <code>darwin-arm64</code>，之后安装 <code>wireguard-tools</code>:</p><figure class="hljs highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ brew install wireguard-tools<br></code></pre></td></tr></table></figure><p>然后执行 <code>netclient join</code> 就行了。</p><h2 id="查看节点"><a href="#查看节点" class="headerlink" title="查看节点"></a>查看节点</h2><p>在节点上执行 wg 可以看到加入的虚拟网络和链接的节点。</p><figure class="hljs highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ wg<br>interface: nm-ten<br>  public key: aH4j5K2TiYhhwI9Bz0tmxxxx<br>  private key: (hidden)<br>  listening port: 51821<br><br>peer: mbv8tihsqvvtgcejLGB+xxxxx<br>  endpoint: 81.70.xxx.xxx:51821<br>  allowed ips: 10.1.0.3/32<br>  latest handshake: 35 seconds ago<br>  transfer: 14.37 MiB received, 54.71 MiB sent<br>  persistent keepalive: every 20 seconds<br><br>peer: WDEfuS8deFQyd6syZJNtaxxxx<br>  endpoint: 82.156.xxx.xxx:51821<br>  allowed ips: 10.1.0.2/32<br>  latest handshake: 35 seconds ago<br>  transfer: 36.74 MiB received, 542.48 MiB sent<br>  persistent keepalive: every 20 seconds<br></code></pre></td></tr></table></figure><ul><li>网络不通请检查 <code>endpoint</code> 端口的连通性</li></ul><p>已经成功分配了ip，ping 一下试试。</p><figure class="hljs highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ ping 10.1.0.2<br>PING 10.1.0.2 (10.1.0.2) 56(84) bytes of data.<br>64 bytes from 10.1.0.2: icmp_seq=1 ttl=64 time=8.69 ms<br>64 bytes from 10.1.0.2: icmp_seq=2 ttl=64 time=9.74 ms<br>64 bytes from 10.1.0.2: icmp_seq=3 ttl=64 time=51.0 ms<br>^C<br>--- 10.1.0.2 ping statistics ---<br>3 packets transmitted, 3 received, 0% packet loss, time 2003ms<br>rtt min/avg/max/mdev = 8.698/23.165/51.057/19.727 ms<br><br>$ ping 10.1.0.3<br>PING 10.1.0.3 (10.1.0.3) 56(84) bytes of data.<br>64 bytes from 10.1.0.3: icmp_seq=1 ttl=64 time=0.893 ms<br>64 bytes from 10.1.0.3: icmp_seq=2 ttl=64 time=0.948 ms<br>64 bytes from 10.1.0.3: icmp_seq=3 ttl=64 time=1.01 ms<br>^C<br>--- 10.1.0.3 ping statistics ---<br>3 packets transmitted, 3 received, 0% packet loss, time 2032ms<br>rtt min/avg/max/mdev = 0.893/0.951/1.014/0.060 ms<br></code></pre></td></tr></table></figure><p>网络已经打通了！</p><h1 id="Ingress-GateWay-和-External-Clients"><a href="#Ingress-GateWay-和-External-Clients" class="headerlink" title="Ingress GateWay 和 External Clients"></a>Ingress GateWay 和 External Clients</h1><p>外部客户端，就是可以访问虚拟网络资源，但是虚拟网络内节点不能反过来访问该外部客户端。通过 <code>Ingress GateWay</code> 入口网关实现。<br>具体就是选择一个节点开启 <code>Ingress GateWay</code> 使其变成一个中继节点，然后在其上添加外部客户端 <code>External Clients</code> 生成配置文件及二维码。中继节点负责为外部客户端的流量请求进行转发。<br><code>Linux</code>、<code>macOS</code>、<code>Windows</code> 可以通过 <code>wg-quick up /path/to/config</code> 命令接入网络。<br><code>Android</code> 和 <code>iOS</code> 下载 <code>WireGuard App</code> 通过扫描配置二维码就可以接入网络了。</p><ul><li>生成的配置是固定的，网络节点配置修改后需要重新生成配置</li></ul><h1 id="Egress-GateWay"><a href="#Egress-GateWay" class="headerlink" title="Egress GateWay"></a>Egress GateWay</h1><p>比如我现在的组网状态下，<code>ten-2</code> 节点私有局域网段是 <code>10.0.8.0/22</code>，<code>ten</code> 网络内其它节点想要访问该私有局域网段的其它服务器，通过 <code>Egress GateWay</code> 出口网关可以实现。</p><p>在 <code>ten-2</code> 节点上创建出口网关后通过 <code>wg</code> 查看配置同步完成网络就打通了。另外通过逗号分隔可以支持多个网段。</p><p><img src="/images/netmaker_8.png" alt="Egress GateWay"></p><figure class="hljs highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ wg<br>interface: nm-ten<br>  public key: aH4j5K2TiYhhwI9Bz0tmxxxx<br>  private key: (hidden)<br>  listening port: 51821<br><br>peer: mbv8tihsqvvtgcejLGB+xxxxx<br>  endpoint: 81.70.xxx.xxx:51821<br>  allowed ips: 10.1.0.3/32<br>  latest handshake: 55 seconds ago<br>  transfer: 644.40 MiB received, 24.83 MiB sent<br>  persistent keepalive: every 20 seconds<br><br>peer: WDEfuS8deFQyd6syZJNtaxxxx<br>  endpoint: 82.156.xxx.xxx:51821<br>  allowed ips: 10.1.0.2/32, 10.0.8.0/22<br>  latest handshake: 44 seconds ago<br>  transfer: 569.67 MiB received, 38.38 MiB sent<br>  persistent keepalive: every 20 seconds<br></code></pre></td></tr></table></figure><h1 id="其它"><a href="#其它" class="headerlink" title="其它"></a>其它</h1><p>组网成功后部署了 k8s 集群, 可以进一步折腾了。</p><p>另外推荐一个 k8s 可视化管理工具 <a href="https://github.com/lensapp/lens" target="_blank" rel="noopener">Lens</a>，号称是 k8s 的 IDE，操作 k8s 相当方便。</p><p><img src="/images/netmaker_9.jpg" alt="Lens Cluster"></p><p><img src="/images/netmaker_10.png" alt="Lens Nodes"></p></main><footer class="post-footer"><div class="post-tags"><a class="post-tag button" href="/tags/k8s/" rel="tag"><i class="fas fa-tags"></i>k8s</a></div></footer></article><nav class="page-nav"><div class="page-nav-next page-nav-item"><a href="/2022/02/26/book_of_exam_brain_science/" rel="next" title="关于学习和记忆的原理《考试脑科学》"><i class="fas fa-angle-left"></i><span class="nav-title">关于学习和记忆的原理《考试脑科学》</span></a></div><div class="page-nav-prev page-nav-item"></div></nav><link rel="stylesheet" href="//api.ibelieving.io/src/iDisqus.min.css?v=20190831"><script src="//api.ibelieving.io/src/iDisqus.min.js?v=20190831"></script><div id="comment"></div><script>function loadDisqus(){new iDisqus("comment",{forum:"ibelieving",site:"https://ibelieving.io",api:"https://api.ibelieving.io/api",url:"2022/03/13/netmaker/",mode:1,timeout:2e3,init:!0,emojiPreview:!0}).count()}var runningOnBrowser="undefined"!=typeof window,isBot=runningOnBrowser&&!("onscroll"in window)||"undefined"!=typeof navigator&&/(gle|ing|ro|msn)bot|crawl|spider|yand|duckgo/i.test(navigator.userAgent),supportsIntersectionObserver=runningOnBrowser&&"IntersectionObserver"in window;setTimeout(function(){var n;!isBot&&supportsIntersectionObserver?(n=new IntersectionObserver(function(e){e[0].isIntersecting&&(loadDisqus(),n.disconnect())},{threshold:[0]})).observe(document.getElementById("comment")):loadDisqus()},1)</script></div></div><aside class="sidebar" id="sidebar" style="background-size:50%"><div class="search"><div class="form-group"><i class="fas fa-search"></i><input type="search" id="search-input" name="q" results="0" placeholder="搜索" class="form-control"></div></div><div class="search-result-box" id="search-result"></div><div class="info sidebar-item" id="info"><img class="author-avatar" src="/images/avatar.gif" alt="Zhongyang Hao"><h1 class="author-name">Zhongyang Hao</h1><h2 class="author-description">技术分享，包括不限于微服务、服务网格。主要开发语言PHP、Golang。</h2><div class="blog-sidebar-tags"><h4 class="blog-sidebar-h4"><i class="fa fa-tag"></i>&nbsp;标签云</h4><ul class="blog-sidebar-tags-ul blog-sidebar-padding"><li><a href="/tags/Docker/" class="tag-could" data-toggle="tooltip" data-placement="top" title="Docker">Docker</a></li><li><a href="/tags/%E5%BE%AE%E6%9C%8D%E5%8A%A1/" class="tag-could" data-toggle="tooltip" data-placement="top" title="微服务">微服务</a></li><li><a href="/tags/PHP/" class="tag-could" data-toggle="tooltip" data-placement="top" title="PHP">PHP</a></li><li><a href="/tags/Swoole/" class="tag-could" data-toggle="tooltip" data-placement="top" title="Swoole">Swoole</a></li><li><a href="/tags/Consul/" class="tag-could" data-toggle="tooltip" data-placement="top" title="Consul">Consul</a></li><li><a href="/tags/Traefik/" class="tag-could" data-toggle="tooltip" data-placement="top" title="Traefik">Traefik</a></li><li><a href="/tags/Go/" class="tag-could" data-toggle="tooltip" data-placement="top" title="Go">Go</a></li><li><a href="/tags/%E7%88%AC%E8%99%AB/" class="tag-could" data-toggle="tooltip" data-placement="top" title="爬虫">爬虫</a></li><li><a href="/tags/Kindle/" class="tag-could" data-toggle="tooltip" data-placement="top" title="Kindle">Kindle</a></li><li><a href="/tags/mobi/" class="tag-could" data-toggle="tooltip" data-placement="top" title="mobi">mobi</a></li><li><a href="/tags/IDE/" class="tag-could" data-toggle="tooltip" data-placement="top" title="IDE">IDE</a></li><li><a href="/tags/nps/" class="tag-could" data-toggle="tooltip" data-placement="top" title="nps">nps</a></li><li><a href="/tags/%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F/" class="tag-could" data-toggle="tooltip" data-placement="top" title="内网穿透">内网穿透</a></li><li><a href="/tags/%E6%BA%90%E7%A0%81/" class="tag-could" data-toggle="tooltip" data-placement="top" title="源码">源码</a></li><li><a href="/tags/RabbitMQ/" class="tag-could" data-toggle="tooltip" data-placement="top" title="RabbitMQ">RabbitMQ</a></li><li><a href="/tags/Serverless/" class="tag-could" data-toggle="tooltip" data-placement="top" title="Serverless">Serverless</a></li><li><a href="/tags/%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F/" class="tag-could" data-toggle="tooltip" data-placement="top" title="微信小程序">微信小程序</a></li><li><a href="/tags/%E5%89%AF%E4%B8%9A/" class="tag-could" data-toggle="tooltip" data-placement="top" title="副业">副业</a></li><li><a href="/tags/TCP/" class="tag-could" data-toggle="tooltip" data-placement="top" title="TCP">TCP</a></li><li><a href="/tags/k8s/" class="tag-could" data-toggle="tooltip" data-placement="top" title="k8s">k8s</a></li></ul></div><script>var tag_cloud=$(".tag-could");tag_cloud.each(function(){var a=parseInt(6*Math.random());$(this).addClass("tag-could"+a)})</script></div><div class="sidebar-sticky"><hr><div class="post-toc sidebar-item" id="toc-div"><div><i class="fas fa-list-ol"></i>文章目录</div><div class="post-toc-content"><ol class="list-group toc"><li class="toc-item toc-level-1"><a class="list-group-item toc-link" href="#介绍"><span class="toc-text">介绍</span></a></li><li class="toc-item toc-level-1"><a class="list-group-item toc-link" href="#Netmaker-部署"><span class="toc-text">Netmaker 部署</span></a></li><li class="toc-item toc-level-1"><a class="list-group-item toc-link" href="#Netmaker-创建网络"><span class="toc-text">Netmaker 创建网络</span></a></li><li class="toc-item toc-level-1"><a class="list-group-item toc-link" href="#加入节点"><span class="toc-text">加入节点</span></a><ol class="list-group toc-child"><li class="toc-item toc-level-2"><a class="list-group-item toc-link" href="#macOS-的加入"><span class="toc-text">macOS 的加入</span></a></li><li class="toc-item toc-level-2"><a class="list-group-item toc-link" href="#查看节点"><span class="toc-text">查看节点</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="list-group-item toc-link" href="#Ingress-GateWay-和-External-Clients"><span class="toc-text">Ingress GateWay 和 External Clients</span></a></li><li class="toc-item toc-level-1"><a class="list-group-item toc-link" href="#Egress-GateWay"><span class="toc-text">Egress GateWay</span></a></li><li class="toc-item toc-level-1"><a class="list-group-item toc-link" href="#其它"><span class="toc-text">其它</span></a></li></ol></div></div><hr><div class="social-link sidebar-item"><div><i class="far fa-address-card"></i>社交链接<p></p></div><ul><li><i class="fas fa-envelope"></i><a href="mailto:zyh94946@gmail.com" target="_blank">E-Mail</a></li><li><i class="fab fa-github"></i><a href="https://github.com/zyh94946" target="_blank">GitHub</a></li></ul></div></div></aside></div></div></main><footer id="footer" class="footer" style="background-color:#000"><div class="container"><div class="back-to-top"><button id="back-to-top"><i class="fas fa-angle-double-up" aria-label="回到顶部"></i></button></div><div class="footer-container"><div class="footer-left"><div class="copyright"><span class="author">Zhongyang Hao</span><span class="year"><i class="far fa-copyright"></i>2017 - 2022</span><span class="creative-commons"><i class="fab fa-creative-commons"></i><a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">BY-NC-SA 4.0</a></span></div><div class="busuanzi"><span id="busuanzi_container_site_pv"><i class="fas fa-eye" aria-label="站点点击量" aria-hidden="false"></i><span id="busuanzi_value_site_pv"></span></span><span id="busuanzi_container_site_uv"><i class="fas fa-user" aria-label="站点用户数" aria-hidden="false"></i><span id="busuanzi_value_site_uv"></span></span><span id="busuanzi_container_page_pv"><i class="far fa-file-alt"></i><span id="busuanzi_value_page_pv" aria-label="页面点击量" aria-hidden="false"></span></span></div></div><div class="footer-right"><div class="custom-info">托管于<i class="fab fa-github-alt"></i><a href="https://pages.github.com/" target="_blank">GitHub Pages</a></div><div class="powered-by">由 <a href="https://hexo.io/" target="_blank">Hexo</a> 强力驱动 | 主题 <a href="https://github.com/AlynxZhou/hexo-theme-aria/" target="_blank">ARIA</a></div></div></div></div></footer></body></html>