/*! DisqusJS v1.3.0 | Sukka (https://skk.moe) | https://disqusjs.skk.moe | MIT License */"use strict";function _createForOfIteratorHelperLoose(e,s){var t;if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator])return(t=e[Symbol.iterator]()).next.bind(t);if(Array.isArray(e)||(t=_unsupportedIterableToArray(e))||s&&e&&"number"==typeof e.length){t&&(e=t);var r=0;return function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,s){if(e){if("string"==typeof e)return _arrayLikeToArray(e,s);var t=Object.prototype.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?_arrayLikeToArray(e,s):void 0}}function _arrayLikeToArray(e,s){(null==s||s>e.length)&&(s=e.length);for(var t=0,r=new Array(s);t<s;t++)r[t]=e[t];return r}function DisqusJS(e){!function(s,t,r,n,a){function o(){for(var e=arguments.length,s=new Array(e),t=0;t<e;t++)s[t]=arguments[t];return(o=Object.assign||function(e){for(var s,t=_createForOfIteratorHelperLoose(arguments);!(s=t()).done;){var r=s.value;for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,s)}var i=function(e){return t.getElementById(e)},d=function(e){var s=i("dsqjs-msg");s&&(s.innerHTML=e)},c="click",l="disqus_thread",u="dsqjs_sort",m='target="_blank" rel="external nofollow noopener noreferrer"',f='<footer><p class="dsqjs-footer">Powered by <a class="dsqjs-disqus-logo" href="https://disqus.com" '+m+'></a>&nbsp;&amp;&nbsp;<a href="https://disqusjs.skk.moe" target="_blank">DisqusJS</a></p></footer>',p=function(e,s,t){var r=e.avatarEl,n=e.createdAt;return'<div class="dsqjs-post-item dsqjs-clearfix"><div class="dsqjs-post-avatar">'+r+'</div><div class="dsqjs-post-body"><div class="dsqjs-post-header">'+s+'<span class="dsqjs-meta"><time>'+g(n)+'</time></span></div><div class="dsqjs-post-content">'+t+"</div></div></div>"},q='如需完整体验请针对 disq.us | disquscdn.com | disqus.com 启用代理并 <a id="dsqjs-reload-disqus" class="dsqjs-msg-btn">尝试完整 Disqus 模式</a> | <a id="dsqjs-force-disqus" class="dsqjs-msg-btn">强制完整 Disqus 模式</a>',h=function(e){return n(e,{method:"GET"}).then((function(e){return a.all([e.ok,e.status,e.json(),e.headers])})).then((function(e){var s=e[0],t=e[1],r=e[2],n=e[3];if(s)return{ok:s,status:t,data:r,headers:n};throw new Error})).catch((function(e){throw e}))},v=function(e,s){try{r.setItem(e,s)}catch(e){}},g=function(e){function s(e){return e<10?"0"+e:e}return e=Date.parse(new Date(e)),(e=new Date(e+288e5)).getFullYear()+"-"+s(e.getMonth()+1)+"-"+s(e.getDate())+" "+s(e.getHours())+":"+s(e.getMinutes())};function j(){var e;s.DISQUS?s.DISQUS.reset({reload:!0,config:function(){this.page.identifier=D.config.identifier,this.page.url=D.config.url,this.page.title=D.config.title}}):(e=t.createElement("script"),i(l).innerHTML='<div id="dsqjs"><section><div id="dsqjs-msg">评论完整模式加载中... 如果长时间无法加载，请针对 disq.us | disquscdn.com | disqus.com 启用代理，或切换至 <a id="dsqjs-force-dsqjs" class="dsqjs-msg-btn">评论基础模式</a></div></section>'+f+"</div>",i("dsqjs-force-dsqjs").addEventListener(c,T),e.src="https://"+D.config.shortname+".disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e))}function b(){i(l).innerHTML='<div id="dsqjs"><section><div id="dsqjs-msg">正在检查 Disqus 能否访问...</div></section>'+f+"</div>";for(var e=["disqus.com",D.config.shortname+".disqus.com"],s=0,t=0,r=function(){e.length===s&&s===t?w():e.length===s&&T()},n=0,a=e;n<a.length;n++)!function(e){var n=new Image,a=setTimeout((function(){n.onerror=n.onload=null,s++,r()}),3e3);n.onerror=function(){clearTimeout(a),s++,r()},n.onload=function(){clearTimeout(a),s++,t++,r()},n.src="https://"+e+"/favicon.ico?"+ +new Date+"="+ +new Date}(a[n])}function y(){i("dsqjs-reload-disqus").addEventListener(c,b),i("dsqjs-force-disqus").addEventListener(c,w)}function L(){d("评论基础模式加载中... "+q),y();var e=D.config.api+"3.0/threads/list.json?forum="+D.config.shortname+"&thread=ident:"+D.config.identifier+"&api_key="+H();h(e).then((function(e){var t=e.data;if(0===t.code&&1===t.response.length){var r=t.response[0],n=r.id,a=r.title,o=r.isClosed,u=r.posts;D.page={id:n,title:a,isClosed:o,length:u,comment:[]},i(l).innerHTML='<div id="dsqjs"><div id="dsqjs-msg">评论基础模式加载中... '+q+"</div>"+function(e,s){return'<header class="dsqjs-header" id="dsqjs-header"><nav class="dsqjs-nav dsqjs-clearfix"><ul><li class="dsqjs-nav-tab dsqjs-tab-active"><span>'+e+' Comments</span></li><li class="dsqjs-nav-tab">'+s+'</li></ul><div class="dsqjs-order"><input class="dsqjs-order-radio" id="dsqjs-order-desc" type="radio" name="comment-order" value="desc" checked="true"><label class="dsqjs-order-label" for="dsqjs-order-desc" title="按从新到旧">最新</label><input class="dsqjs-order-radio" id="dsqjs-order-asc" type="radio" name="comment-order" value="asc"><label class="dsqjs-order-label" for="dsqjs-order-asc" title="按从旧到新">最早</label><input class="dsqjs-order-radio" id="dsqjs-order-popular" type="radio" name="comment-order" value="popular"><label class="dsqjs-order-label" for="dsqjs-order-popular" title="按评分从高到低">最佳</label></div></nav></header>'}(u,D.config.siteName)+'<section class="dsqjs-post-container"><ul class="dsqjs-post-list" id="dsqjs-post-container"><p class="dsqjs-no-comment">评论列表加载中...</p></ul><a id="dsqjs-load-more" class="dsqjs-load-more dsqjs-hide">加载更多评论</a></section>'+f+"</div>",y(),i("dsqjs-order-"+D.sortType).setAttribute("checked","true"),s()}else{if(0!==t.code||1===t.response.length)throw new Error;d('当前 Thread 尚未创建。是否切换至 <a id="dsqjs-force-disqus" class="dsqjs-msg-btn">完整 Disqus 模式</a>？'),i("dsqjs-force-disqus").addEventListener(c,w)}})).catch(E);var s=function e(s){function n(){for(var e,s=_createForOfIteratorHelperLoose(o);!(e=s()).done;)e.value.removeEventListener("change",f);a.removeEventListener(c,m);for(var t,r=_createForOfIteratorHelperLoose(l);!(t=r()).done;)t.value.removeEventListener(c,b)}void 0===s&&(s="");var a=i("dsqjs-load-more"),o=t.getElementsByClassName("dsqjs-order-radio"),l=t.getElementsByClassName("dsqjs-has-more-btn"),m=function(){n(),e(D.page.next)},f=function(s){var t=s.target;D.sortType=t.getAttribute("value"),v(u,D.sortType),n(),D.page.comment=[],D.page.next="",i("dsqjs-post-container").innerHTML='<p class="dsqjs-no-comment">正在切换排序方式...</p>',a.classList.add("dsqjs-hide"),e()},p=""===s?"":"&cursor="+s;function g(e){var s=e.createdAt;return Date.parse(new Date(s))}function j(e,s){return e.parent&&s.parent?g(e)-g(s):0}a.classList.add("dsqjs-disabled");var L=D.config.api+"3.0/threads/listPostsThreaded?forum="+D.config.shortname+"&thread="+D.page.id+p+"&api_key="+H()+"&order="+D.sortType;h(L).then((function(e){var s,t=e.data;if(0===t.code&&0<t.response.length){a.classList.remove("dsqjs-disabled"),(s=D.page.comment).push.apply(s,t.response),D.page.comment.sort(j),r(D.page.comment);for(var n,u=_createForOfIteratorHelperLoose(o);!(n=u()).done;)n.value.addEventListener("change",f);for(var p,h=_createForOfIteratorHelperLoose(l);!(p=h()).done;)p.value.addEventListener(c,b);t.cursor.hasNext?(D.page.next=t.cursor.next,a.innerHTML="加载更多评论",a.classList.remove("dsqjs-hide"),a.addEventListener(c,m)):a.classList.add("dsqjs-hide")}else{if(0!==t.code||0!==t.response.length)throw new Error;d("你可能无法访问 Disqus，已启用评论基础模式。"+q),i("dsqjs-post-container").innerHTML='<p class="dsqjs-no-comment" >'+D.config.nocomment+"</p>",y(),i("dsqjs-force-disqus").addEventListener(c,T)}})).catch((function(){""===s?E():(a.classList.remove("dsqjs-disabled"),a.innerHTML="加载更多评论失败，点击重试",a.addEventListener(c,m))}))},r=function(e){function s(e){return e.comment.author.profileUrl?(e.comment.avatarEl='<a href="'+e.comment.author.profileUrl+'"><img src="'+n(e.comment.author.avatar.cache)+'" '+m+"></a>",e.comment.authorEl='<span class="dsqjs-post-author"><a href="'+e.comment.author.profileUrl+'" '+m+">"+e.comment.author.name+"</a></span>"):(e.comment.avatarEl='<img src="'+n(e.comment.author.avatar.cache)+'">',e.comment.authorEl='<span class="dsqjs-post-author">'+e.comment.author.name+"</span>"),D.config.adminLabel&&e.isPrimary&&(e.comment.authorEl+='<span class="dsqjs-admin-badge">'+D.config.adminLabel+"</span>"),e}function r(e){var s="",r=e.isDeleted?"<small>此评论已被删除</small>":(s=e.authorEl+'<span class="dsqjs-bullet"></span>',function(e){var s=t.createElement("div");s.innerHTML=e;for(var r,n=_createForOfIteratorHelperLoose(s.getElementsByTagName("a"));!(r=n()).done;){var a=r.value,o=decodeURIComponent(a.href.replace(/https:\/\/disq.us\/url\?url=/g,"")).replace(/(.*):.+cuid=.*/,"$1");a.href=o,a.innerHTML=o,a.rel="external noopener nofollow noreferrer",a.target="_blank"}return s.innerHTML}(n(e.message)));return p(e,s,r)}var n=function(e){return e.replace("/a.disquscdn.com/ig","c.disquscdn.com")},a="";(function(e){function s(e){return{comment:e,author:e.author.name,isPrimary:!!D.config.admin&&e.author.username===D.config.admin,children:n(+e.id),hasMore:e.hasMore}}var t=[],r=[],n=function(e){if(0===r.length)return null;for(var t,n=[],a=_createForOfIteratorHelperLoose(r);!(t=a()).done;){var o=t.value;o.parent===e&&n.unshift(s(o))}return n.length?n:null};return e.forEach((function(e){(e.parent?r:t).push(e)})),t.map(s)})(e).map((function(e){e.children&&(e.nesting=1);var t="";(e=s(e)).hasMore&&(t='<p class="dsqjs-has-more">切换至 <a id="load-more-'+e.comment.id+'">完整 Disqus 模式</a> 显示更多回复</p>'),a+='<li data-id="comment-'+e.comment.id+'" id="comment-'+e.comment.id+'">'+r(e.comment)+function e(t){var n=t.nesting,a=t.children||[];if(a){var o="";o=n<D.config.nesting?'<ul class="dsqjs-post-list dsqjs-children">':'<ul class="dsqjs-post-list">';return a.map((function(t){(t=s(t)).nesting=n+1;var a="";t.hasMore&&(a='<p class="dsqjs-has-more">切换至 <a class="dsqjs-has-more-btn" id="load-more-'+t.comment.id+'" data-more-id="comment-'+t.comment.id+'">完整 Disqus 模式</a> 显示更多回复</p>'),o+='<li data-id="comment-'+t.comment.id+'" id="comment-'+t.comment.id+'">'+r(t.comment)+e(t)+a+"</li>"})),0!==(o+="</ul>").length?o:void 0}}(e)+t+"</li>"})),d("你可能无法访问 Disqus，已启用评论基础模式。"+q),i("dsqjs-post-container").innerHTML=a,y()}}function E(e){console.log(e),d('评论基础模式加载失败，是否 <a id="dsqjs-reload-dsqjs" class="dsqjs-msg-btn">重载</a> 或 <a id="dsqjs-reload-disqus" class="dsqjs-msg-btn">尝试完整 Disqus 模式</a> ？'),i("dsqjs-reload-dsqjs").addEventListener(c,L),i("dsqjs-reload-disqus").addEventListener(c,b)}function T(){v("dsqjs_mode","dsqjs"),L()}function w(){v("dsqjs_mode","disqus"),j()}var D={},_=t.location.origin+t.location.pathname+t.location.search;D.config=o({api:"https://disqus.skk.moe/disqus/",identifier:_,url:_,title:t.title,siteName:"",nesting:parseInt(e.nesting)||4,nocomment:"这里冷冷清清的，一条评论都没有"},e),D.page={};var I=D.config.apikey,H=function(){return Array.isArray(I)?I[Math.floor(Math.random()*I.length)]:I};s.disqus_config=function(){this.page.url=D.config.url,this.page.identifier=D.config.identifier,this.page.title=D.config.title},i(l).innerHTML='<div id="dsqjs"><div id="dsqjs-msg"></div>'+f+"</div>",n&&r&&a?(D.mode=r.getItem("dsqjs_mode"),D.sortType=r.getItem(u)||r.getItem("disqus.sort"),D.sortType||(v(u,"desc"),D.sortType="desc"),("disqus"===D.mode?j:"dsqjs"===D.mode?L:b)()):(d("你的浏览器版本过低，不兼容评论基础模式。"+q),y())}(window,document,localStorage,fetch,Promise)}try{module.exports=DisqusJS}catch(e){}